<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
  <title>Poker Flip App</title>
  <meta name="description" content="„Éà„É©„É≥„Éó„Ç´„Éº„Éâ„Çí„Éï„É™„ÉÉ„Éó„Åó„Å¶Ë°®Á§∫„Åô„Çã„Éü„Éã„Ç¢„Éó„É™">
  
  <!-- PWAË®≠ÂÆö -->
  <meta name="theme-color" content="#ff9f43">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Poker Flip">
  <meta name="msapplication-TileColor" content="#ff9f43">
  <meta name="msapplication-tap-highlight" content="no">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="Poker Flip">
  <meta name="format-detection" content="telephone=no">
  
  <!-- „Ç¢„Ç§„Ç≥„É≥Ë®≠ÂÆö -->
  <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIGZpbGw9IiM2NjdlZWEiIHJ4PSI0Ii8+PHJlY3QgeD0iNiIgeT0iOCIgd2lkdGg9IjkiIGhlaWdodD0iMTMiIGZpbGw9IiNmZmZmZmYiIHJ4PSIyIi8+PHJlY3QgeD0iMTAiIHk9IjEwIiB3aWR0aD0iOSIgaGVpZ2h0PSIxMyIgZmlsbD0iI2ZmZmZmZiIgcng9IjIiLz48dGV4dCB4PSIxNiIgeT0iMjIiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSI4IiBmaWxsPSIjZmZmZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5QPC90ZXh0Pjwvc3ZnPg==">
  <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjE5MiIgaGVpZ2h0PSIxOTIiIGZpbGw9IiM2NjdlZWEiIHJ4PSIyNCIvPjxyZWN0IHg9IjM2IiB5PSI0OCIgd2lkdGg9IjU0IiBoZWlnaHQ9Ijc4IiBmaWxsPSIjZmZmZmZmIiByeD0iMTIiLz48cmVjdCB4PSI2MCIgeT0iNjAiIHdpZHRoPSI1NCIgaGVpZ2h0PSI3OCIgZmlsbD0iI2ZmZmZmZiIgcng9IjEyIi8+PHRleHQgeD0iOTYiIHk9IjEzMiIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjQ4IiBmaWxsPSIjZmZmZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5Qb2tlcjwvdGV4dD48L3N2Zz4=">
  
  <!-- Web App Manifest -->
  <link rel="manifest" href="./manifest.json">
  
  <link rel="stylesheet" href="./cards.css">
  <style>
    * {
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      box-sizing: border-box;
    }
    
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #ffb366 0%, #ff9f43 50%, #ff8c42 100%);
      background-attachment: fixed;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
    }

    .container {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
      padding: 24px;
      width: 100%;
      max-width: 960px;
      box-sizing: border-box;
    }

    h1 {
      margin: 0 0 16px;
      text-align: center;
      color: #333;
    }

    .toolbar {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      background: #667eea;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(102,126,234,0.4);
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    #revealBoardBtn {
      background: linear-gradient(135deg, #ff6b9d 0%, #ff8fab 100%);
      box-shadow: 0 4px 12px rgba(255,107,157,0.4);
    }

    #revealBoardBtn:hover {
      background: linear-gradient(135deg, #ff5a8a 0%, #ff7fa1 100%);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(80px, 1fr));
      gap: 12px;
      justify-items: center;
    }

    @media (max-width: 640px) {
      .grid { grid-template-columns: repeat(3, 1fr); }
    }

    .copyright {
      text-align: center;
      font-size: 12px;
      color: #333;
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px solid rgba(0, 0, 0, 0.2);
      font-family: Arial, sans-serif;
      letter-spacing: 0.5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Poker Flip App</h1>
    
    

    <h2 style="margin:0 0 8px; text-align:center; color:#333; font-size:18px;">NLH „Éï„É™„ÉÉ„Éó„Ç¢„Ç¶„Éà</h2>
    <div class="toolbar" id="nlhToolbar">
      <label style="display:flex; align-items:center; gap:8px; font-weight:bold; color:#333;">
        „Éó„É¨„Ç§„É§„Éº‰∫∫Êï∞
        <input id="playersCount" type="number" min="2" max="12" step="1" value="6" style="width:64px; padding:10px 12px; border-radius:10px; border:1px solid #ccc; font-size:14px;">
        <button id="playersInc" class="btn" aria-label="‰∫∫Êï∞„ÇíÂ¢ó„ÇÑ„Åô" style="padding:6px 10px; line-height:1;">‚ñ≤</button>
        <button id="playersDec" class="btn" aria-label="‰∫∫Êï∞„ÇíÊ∏õ„Çâ„Åô" style="padding:6px 10px; line-height:1;">‚ñº</button>
      </label>
      <button class="btn" id="startFlipoutBtn" aria-label="Êñ∞„Åó„ÅÑ„Éè„É≥„Éâ„ÇíÈñãÂßã">Êñ∞„Åó„ÅÑ„Éè„É≥„Éâ</button>
      <button class="btn" id="revealBoardBtn" aria-label="„Éú„Éº„Éâ„Ç´„Éº„Éâ„ÇíÈ†Ü„Å´ÂÖ¨Èñã">„Éú„Éº„Éâ„ÇíÂá∫„Åô</button>
      <button class="btn" id="showdownBtn" aria-label="„Ç∑„Éß„Éº„ÉÄ„Ç¶„É≥„Åó„Å¶ÂΩπ„ÇíÂà§ÂÆö">„Ç∑„Éß„Éº„ÉÄ„Ç¶„É≥ÔºàÂΩπ„ÅÆÂà§ÂÆöÔºâ</button>
    </div>

    <div id="tableArea">
      <div style="display:flex; align-items:center; justify-content:center; gap:16px; width:100%;">
        <div class="board-holder">
          <div id="community" class="board-row"></div>
        </div>
      </div>
      <div id="seats" class="seats"></div>
      <div id="status" class="status"></div>
    </div>

    <!-- „Ç≥„Éî„Éº„É©„Ç§„Éà -->
    <div class="copyright">
      ¬© 2025 D.Düêè. All rights reserved.
    </div>
    
  </div>

  <script type="module" src="./cards.js"></script>
  
  <!-- Service WorkerÁôªÈå≤ -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then((registration) => {
            console.log('Service Worker registered successfully:', registration.scope);
          })
          .catch((error) => {
            console.log('Service Worker registration failed:', error);
          });
      });
    }
    
    // PWA„Ç§„É≥„Çπ„Éà„Éº„É´‰øÉÈÄ≤
    let deferredPrompt;
    
    window.addEventListener('beforeinstallprompt', (e) => {
      console.log('PWA„Ç§„É≥„Çπ„Éà„Éº„É´ÂèØËÉΩ');
      e.preventDefault();
      deferredPrompt = e;
      
      // „Ç§„É≥„Çπ„Éà„Éº„É´„Éú„Çø„É≥„ÇíË°®Á§∫
      const installBtn = document.createElement('button');
      installBtn.textContent = 'üì± „Ç¢„Éó„É™„Çí„Ç§„É≥„Çπ„Éà„Éº„É´';
      installBtn.className = 'btn';
      installBtn.style.margin = '8px';
      installBtn.style.background = 'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)';
      installBtn.style.boxShadow = '0 4px 12px rgba(34,197,94,0.4)';
      
      installBtn.setAttribute('aria-label', '„Åì„ÅÆ„Ç¢„Éó„É™„Çí„Éõ„Éº„É†ÁîªÈù¢„Å´„Ç§„É≥„Çπ„Éà„Éº„É´');

      installBtn.addEventListener('click', () => {
        if (deferredPrompt) {
          deferredPrompt.prompt();
          deferredPrompt.userChoice.then((choiceResult) => {
            if (choiceResult.outcome === 'accepted') {
              console.log('PWA„Ç§„É≥„Çπ„Éà„Éº„É´ÊâøË™ç');
            } else {
              console.log('PWA„Ç§„É≥„Çπ„Éà„Éº„É´ÊãíÂê¶');
            }
            deferredPrompt = null;
            installBtn.remove();
          });
        }
      });
      
      // „ÉÑ„Éº„É´„Éê„Éº„Å´ËøΩÂä†
      const toolbar = document.querySelector('.toolbar');
      if (toolbar) {
        toolbar.appendChild(installBtn);
      }
    });
    
    // „Ç§„É≥„Çπ„Éà„Éº„É´ÂÆå‰∫Ü„ÅÆÊ§úÁü•
    window.addEventListener('appinstalled', (evt) => {
      console.log('PWA„Åå„Ç§„É≥„Çπ„Éà„Éº„É´„Åï„Çå„Åæ„Åó„Åü');
    });
  </script>
  
  <script type="module">
    import { startNewHand, startNewHandAnimated, showdown, autoReveal } from './cards.js';

    const seats = document.getElementById('seats');
    const community = document.getElementById('community');
    const statusEl = document.getElementById('status');

    // NLH Flipout controls
    const playersCountInput = document.getElementById('playersCount');
    const startFlipoutBtn = document.getElementById('startFlipoutBtn');
    const revealBoardBtn = document.getElementById('revealBoardBtn');
    const showdownBtn = document.getElementById('showdownBtn');
    const playersInc = document.getElementById('playersInc');
    const playersDec = document.getElementById('playersDec');
    

    // „Ç§„É≥„Çπ„Éà„Éº„É´Ê°àÂÜÖ„ÇíÈö†„Åô„É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£ÔºàAndroid„Éú„Çø„É≥/iOS„Éí„É≥„Éà„ÅÆ‰∏°Êñπ„ÇíÂØæË±°Ôºâ
    function hideInstallPrompt() {
      const btn = document.querySelector('button[aria-label="„Åì„ÅÆ„Ç¢„Éó„É™„Çí„Éõ„Éº„É†ÁîªÈù¢„Å´„Ç§„É≥„Çπ„Éà„Éº„É´"]');
      if (btn) btn.remove();
      const iosHint = document.getElementById('iosInstallHint');
      if (iosHint) iosHint.remove();
    }

    // NLH Flipout events
    startFlipoutBtn.addEventListener('click', async () => {
      hideInstallPrompt();
      const n = Math.max(2, Math.min(12, parseInt(playersCountInput.value || '6', 10)));
      await startNewHandAnimated({ seatsEl: seats, communityEl: community, statusEl, numPlayers: n });
    });

    // ÊâãÂãï„ÅÆ„Éï„É≠„ÉÉ„Éó/„Çø„Éº„É≥/„É™„Éê„Éº„ÅØÂâäÈô§ÔºàËá™ÂãïÈÄ≤Ë°å„Å´‰∏ÄÊú¨ÂåñÔºâ

    showdownBtn.addEventListener('click', () => {
      hideInstallPrompt();
      showdown();
    });


    // „Éú„Éº„Éâ„ÇíÂá∫„Åô: „Éï„É≠„ÉÉ„Éó‚Üí„Çø„Éº„É≥‚Üí„É™„Éê„Éº„ÅÆËá™ÂãïÂÖ¨Èñã
    revealBoardBtn.addEventListener('click', () => {
      hideInstallPrompt();
      autoReveal({ flopDelayMs: 600, turnDelayMs: 1000, riverDelayMs: 1000, autoShowdown: false });
    });

    // --- iOS SafariÂêë„Åë: beforeinstallprompt„ÅåÁÑ°„ÅÑ„Åü„ÇÅ„ÄÅ„Éà„ÉÉ„Éó„ÅÆ„Åø„Éí„É≥„Éà„ÇíË°®Á§∫ ---
    (function showIosInstallHintIfNeeded() {
      const ua = navigator.userAgent || navigator.vendor || window.opera;
      const isIOS = /iPad|iPhone|iPod/.test(ua);
      const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true;
      const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
      if (isIOS && isSafari && !isStandalone) {
        const toolbar = document.querySelector('.toolbar');
        if (!toolbar) return;
        const hint = document.createElement('div');
        hint.id = 'iosInstallHint';
        hint.setAttribute('role', 'status');
        hint.setAttribute('aria-live', 'polite');
        hint.style.padding = '8px 12px';
        hint.style.borderRadius = '8px';
        hint.style.background = 'rgba(0,0,0,0.06)';
        hint.style.color = '#333';
        hint.style.fontSize = '12px';
        hint.style.display = 'flex';
        hint.style.alignItems = 'center';
        hint.style.gap = '8px';
        hint.style.maxWidth = '100%';
        hint.innerHTML = 'üì≤ „Éõ„Éº„É†ÁîªÈù¢„Å´ËøΩÂä†„Åô„Çã„Å´„ÅØ„ÄÅSafari„ÅÆÂÖ±Êúâ„Éú„Çø„É≥„Åã„Çâ„Äå„Éõ„Éº„É†ÁîªÈù¢„Å´ËøΩÂä†„Äç„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
        toolbar.appendChild(hint);
      }
    })();

    // ‰∫∫Êï∞„ÅÆ‰∏ä‰∏ã„Éú„Çø„É≥„Å®ÂÖ•Âäõ„ÅÆ„ÇØ„É©„É≥„Éó
    function clampPlayers(val) {
      const n = Math.max(2, Math.min(12, parseInt(val || '6', 10)));
      playersCountInput.value = String(n);
      return n;
    }
    playersInc.addEventListener('click', () => {
      clampPlayers((parseInt(playersCountInput.value || '6', 10) + 1).toString());
    });
    playersDec.addEventListener('click', () => {
      clampPlayers((parseInt(playersCountInput.value || '6', 10) - 1).toString());
    });
    playersCountInput.addEventListener('change', () => clampPlayers(playersCountInput.value));
    playersCountInput.addEventListener('blur', () => clampPlayers(playersCountInput.value));
  </script>
</body>
</html>


